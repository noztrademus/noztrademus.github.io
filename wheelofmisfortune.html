<!DOCTYPE html>
<html lang="sv">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CB60FSK1NV"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CB60FSK1NV');
  </script>

  <meta charset="utf-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wheel of missfortune</title>

  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Sida-specifik CSS (om du vill kan du också flytta denna till style.css) -->
  <style>
    /* D3 text i hjulet */
    #chart text {
      font-family: Helvetica, Arial, sans-serif;
      font-size: 16px;
      pointer-events: none;
    }
  </style>
</head>

<body class="wheel-page">
  <a href="/" class="home-link">&lt; Home</a>

  <main class="page">
    <h2 class="title">THE WHEEL OF MISSFORTUNE</h2>

    <section class="wheel-layout">
      <div id="chart" aria-label="Wheel chart"></div>
      <div id="question" aria-live="polite"><h1></h1></div>
    </section>

    <h2 class="rules-title">GAME RULES: FOLLOW THE RULES!</h2>
  </main>

  <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script type="text/javascript" charset="utf-8">
    // ===== Responsive size =====
    var padding = { top: 20, right: 20, bottom: 20, left: 20 };

    function computeSize() {
      // wheel max 520px, men skalar ned på mobil
      var size = Math.min(window.innerWidth * 0.92, 520);
      return {
        size: size,
        w: size - padding.left - padding.right,
        h: size - padding.top - padding.bottom
      };
    }

    var dims = computeSize();
    var w = dims.w;
    var h = dims.h;
    var r = Math.min(w, h) / 2;

    var rotation = 1,
        oldrotation = 0,
        picked = 10000000,
        oldpick = [],
        color = d3.scale.category20();

    var data = [
      {"label":"Weapon",  "value":1,  "question":"FREE LOADOUT! WITH BLUE WEAPONS!"},
      {"label":"Armor",  "value":1,  "question":"BLUE ARMOR ONLY!"},
      {"label":"Weapon",  "value":1,  "question":"BULLET SPRAYER! Sweet Business & Heavy Machinegun!"},
      {"label":"Show & Tell",  "value":1,  "question":"DEATHSINGER! Everytime you die, sing!"},
      {"label":"Visuals",  "value":1,  "question":"INGEN HUD!"},
      {"label":"Armor",  "value":1,  "question":"WHITE ARMOR ONLY!"},
      {"label":"Weapon",  "value":1,  "question":"SCOUT SCOUT BABY! Endast dubbel scout!"},
      {"label":"Show & Tell",  "value":1,  "question":"DEATHSCREAMER! Everytime you die, SCREAM!"},
      {"label":"Weapon",  "value":1,  "question":"TRIPLE FUSION MODE!"},
      {"label":"Silence",  "value":1,  "question":"NO MIKE! Emotes only!"},
      {"label":"Controls",  "value":1,  "question":"LOOK SENS 1"},
      {"label":"Challenger",  "value":1,  "question":"NO GUNS, abilities only!"},
      {"label":"Weapon",  "value":1,  "question":"SALVATIONS GRIP BABY! With double sidearms!"},
      {"label":"Modless(ter)",  "value":1,  "question":"NO MODS!"},
      {"label":"Dansken",  "value":1,  "question":"DU TALER NU DANSK!"},
      {"label":"Weapon",  "value":1,  "question":"TRIPLE SNIPER MODE!"},
      {"label":"Controls",  "value":1,  "question":"Button layout: MIRROR!"},
      {"label":"Weapon",  "value":1,  "question":"U ARE NOW LARSA! Heir Apparent only!"},
      {"label":"Weapon",  "value":1,  "question":"TRIPLE SHOTGUN MODE!"},
      {"label":"Show & Tell",  "value":1,  "question":"UwU! If someone dies, you go UwUUUUUUUhhhH!"},
      {"label":"Weapon",  "value":1,  "question":"TRIPLE BOW MODE!"},
      {"label":"Glitch",  "value":1,  "question":"TELESTO ONLY! Glitch away!"},
      {"label":"Controls",  "value":1,  "question":"Movement Control: Legacy Southpaw!"},
      {"label":"Lazer",  "value":1,  "question":"LAZER Go pew pew! Trace only!"},
      {"label":"Show & Tell",  "value":1,  "question":"HALLOWEEN IS HERE! Put on a Halloween mask and become the character you chose!"},
      {"label":"Weapon",  "value":1,  "question":"TRIPLE GL MODE!"},
      {"label":"Hive",  "value":1,  "question":"SWORD ONLY! And a tiny glave.."},
      {"label":"Show & Tell",  "value":1,  "question":"Story time! Tell a short story at each wipe!"},
      {"label":"Dirigenten",  "value":1,  "question":"Du bestämmer vad alla ska göra!"}
    ];

    // ===== Build SVG =====
    var svg = d3.select('#chart')
      .append("svg")
      .data([data])
      .attr("width", w + padding.left + padding.right)
      .attr("height", h + padding.top + padding.bottom);

    var container = svg.append("g")
      .attr("class", "chartholder")
      .attr("transform", "translate(" + (w/2 + padding.left) + "," + (h/2 + padding.top) + ")");

    var vis = container.append("g");
    var pie = d3.layout.pie().sort(null).value(function(){ return 1; });
    var arc = d3.svg.arc().outerRadius(r);

    var arcs = vis.selectAll("g.slice")
      .data(pie)
      .enter()
      .append("g")
      .attr("class", "slice");

    arcs.append("path")
      .attr("fill", function(d, i){ return color(i); })
      .attr("d", function(d){ return arc(d); });

    arcs.append("text")
      .attr("transform", function(d){
        d.innerRadius = 0;
        d.outerRadius = r;
        d.angle = (d.startAngle + d.endAngle)/2;
        return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")translate(" + (d.outerRadius - 10) +")";
      })
      .attr("text-anchor", "end")
      .text(function(d, i){ return data[i].label; });

    container.on("click", spin);

    function spin() {
      container.on("click", null);

      if (oldpick.length === data.length) {
        container.on("click", null);
        return;
      }

      var ps = 360 / data.length;
      var rng = Math.floor((Math.random() * 9440) + 360);

      rotation = (Math.round(rng / ps) * ps);

      picked = Math.round(data.length - (rotation % 360) / ps);
      picked = picked >= data.length ? (picked % data.length) : picked;

      if (oldpick.indexOf(picked) !== -1) {
        d3.select(this).call(spin);
        return;
      } else {
        oldpick.push(picked);
      }

      rotation += 90 - Math.round(ps/2);

      vis.transition()
        .duration(5000)
        .attrTween("transform", rotTween)
        .each("end", function(){
          d3.select(".slice:nth-child(" + (picked + 1) + ") path").attr("fill", "#333");
          d3.select("#question h1").text(data[picked].question);
          oldrotation = rotation;
          container.on("click", spin);
        });
    }

    // Arrow
    svg.append("g")
      .attr("transform", "translate(" + (w + padding.left + padding.right) + "," + ((h/2) + padding.top) + ")")
      .append("path")
      .attr("d", "M-" + (r * .15) + ",0L0," + (r * .05) + "L0,-" + (r * .05) + "Z")
      .style({"fill":"black"});

    // Center circle
    container.append("circle")
      .attr("cx", 0)
      .attr("cy", 0)
      .attr("r", Math.max(42, r * 0.18))
      .style({"fill":"white","cursor":"pointer"});

    container.append("text")
      .attr("x", 0)
      .attr("y", 10)
      .attr("text-anchor", "middle")
      .text("SPIN")
      .style({"font-weight":"bold", "font-size": (Math.max(18, r * 0.10)) + "px"});

    function rotTween() {
      var i = d3.interpolate(oldrotation % 360, rotation);
      return function(t) { return "rotate(" + i(t) + ")"; };
    }

    // ===== Optional: rebuild on resize (enkel reload) =====
    // Om du vill att den ska anpassa sig när man roterar mobilen:
    window.addEventListener("resize", function(){
      // lättaste stabila: ladda om
      clearTimeout(window.__rz);
      window.__rz = setTimeout(function(){ location.reload(); }, 150);
    });
  </script>
</body>
</html>
